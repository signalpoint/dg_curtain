var dg_curtain=new dg.Module;dg.modules.dg_curtain=dg_curtain,dg.theme_context_menu=function(t){t._context?t._context:{};return dg.theme("curtain",t)},dg._curtains={},dg_curtain._curtain=null,dg_curtain.getCurtain=function(){return dg_curtain._curtain},dg_curtain.setCurtain=function(t){dg_curtain._curtain=t},dg_curtain.clearCurtain=function(){dg_curtain._curtain=null},dg_curtain.getButton=function(){return dg_curtain.getOpenButton()},dg_curtain.getOpenButton=function(){var t=dg_curtain.getCurtain();return t?document.getElementById(t._open.button._attributes.id):null},dg_curtain.getCloseButton=function(){var t=dg_curtain.getCurtain();return t?document.getElementById(t._close.button._attributes.id):null},dg_curtain.getContainer=function(){var t=dg_curtain.getCurtain();return t?document.getElementById(t._attributes.id):null},dg_curtain.isOpen=function(){var t=dg_curtain.getContainer();return t&&dg.isVisible(t)},dg_curtain.close=function(){var t=dg_curtain.getCloseButton();t&&t.click()},dg.theme_curtain=function(t){t._attributes.id||(t._attributes.id=dg.salt());var e=t._attributes.id;t._attributes.class.push("curtain");var n=t._open?t._open:{},r=n.button?n.button:{};dg.attributesInit(r),r._attributes.id||(r._attributes.id=dg.salt()),r._attributes.onclick||(r._attributes.onclick="dg._curtainClick(this, 'open')"),r._attributes.for||(r._attributes.for=e),dg._curtains[e]=t;var i=dg._curtains[e];return dg._curtainBtnWrapOpen(i)+dg._curtainButtonRender(r,i,"open")+dg._curtainBtnWrapClose(i)},dg._curtainBtnWrapOpen=function(t){var e=t._button_wrapper?t._button_wrapper:null;return e?(dg.elementAttributesInit(e),e._format||(e._format="div"),e._attributes.id="curtain-btn-wrapper-"+t._attributes.id,t._button_wrapper=e,"<"+e._format+" "+dg.attributes(e._attributes)+">"):""},dg._curtainBtnWrapClose=function(t){return t._button_wrapper?"</"+t._button_wrapper._format+">":""},dg._curtainButtonRender=function(t,e,n){var r=t._type?t._type:"link",i=t._text?t._text:"open"==n?"+":"-";return"link"==r?dg.l(i,null,t):dg.b(i,t)},dg._curtainClick=function(t,e){var n=t.getAttribute("for"),r=dg._curtains[n],i=!!r._context,u=!!r._target,a=!i&&r._panel,d="open"==e?"close":"open",_="_"+e,c="_"+d,o=t.getAttribute("id");r[_].before&&r[_].before(t,r);var s=null;if(!a){var g=r[c]?r[c]:{},l=g.button?g.button:{};dg.attributesInit(l),l._attributes.id||(l._attributes.id=o),l._attributes.onclick="dg._curtainClick(this, '"+d+"')",l._attributes.for||(l._attributes.for=n);var b=document.createElement("div");b.innerHTML=dg._curtainButtonRender(l,r,d),s=b.firstChild,t.parentNode.replaceChild(s,t)}var p=function(t){t.style.width="250px"};if("open"==e){var f=null;if(u)f=dg.qs(r._target),f&&(""==f.innerHTML&&(f.innerHTML=dg.render(r._fill())),dg.show(f));else if(f=document.getElementById(n)){var m=document.getElementById(n);a?p(m):dg.show(m)}else{var v=r._attributes.class;i?(v.push("context-menu"),r._context.side&&v.push("context-menu-"+r._context.side)):a&&v.push("side-panel",r._panel.side?"side-panel-"+r._panel.side:"side-panel-left");var B=r._format?variables._format:"div";b=document.createElement("div"),b.innerHTML="<"+B+" "+dg.attributes(r._attributes)+"></"+B+">",s?s.parentNode.insertBefore(b.firstChild,s.nextSibling):t.parentNode.insertBefore(b.firstChild,t.nextSibling);var C=dg.render(r._fill());if(a){var h=r._close?r._close:{},x=h.button?h.button:{};x._attributes||(x._attributes={}),x._attributes.id||(x._attributes.id=o),x._attributes.onclick||(x._attributes.onclick="dg._curtainClick(this, 'close')"),x._attributes.for||(x._attributes.for=n),C=dg._curtainButtonRender(x,r,"close")+C}f=document.getElementById(n),f.innerHTML="open"==e?C:"",(i||a)&&dg._postRender.push(function(){setTimeout(function(){i||a&&p(document.getElementById(n))},50)}),dg.runPostRenders()}dg_curtain.setCurtain(r)}else{var m=u?dg.qs(r._target):document.getElementById(n);a?m.style.width="0":dg.hide(m),dg_curtain.clearCurtain()}r[_].after&&setTimeout(function(){r[_].after(a?t:s,r)},1)};