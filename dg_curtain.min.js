var dg_curtain=new dg.Module;dg.modules.dg_curtain=dg_curtain,dg.theme_context_menu=function(t){t._context?t._context:{};return dg.theme("curtain",t)},dg._curtains={},dg_curtain._curtain=null,dg_curtain.getCurtain=function(){return dg_curtain._curtain},dg_curtain.setCurtain=function(t){dg_curtain._curtain=t},dg_curtain.clearCurtain=function(){dg_curtain._curtain=null},dg_curtain.getButton=function(){var t=dg_curtain.getCurtain();return t?document.getElementById(t._open.button._attributes.id):null},dg_curtain.getContainer=function(){var t=dg_curtain.getCurtain();return t?document.getElementById(t._attributes.id):null},dg_curtain.isOpen=function(){var t=dg_curtain.getContainer();return console.log(t),t&&"none"!=t.style.display},dg_curtain.close=function(){var t=dg_curtain.getButton();t&&t.click()},dg.theme_curtain=function(t){t._attributes.id||(t._attributes.id=dg.salt());var e=t._attributes.id;t._attributes.class.push("curtain");var n=t._open?t._open:{},r=n.button?n.button:{};r._attributes||(r._attributes={}),r._attributes.id||(r._attributes.id=dg.salt()),r._attributes.onclick||(r._attributes.onclick="dg._curtainClick(this, 'open')"),r._attributes.for||(r._attributes.for=e),dg._curtains[e]=t;var i=dg._curtains[e];return dg._curtainBtnWrapOpen(i)+dg._curtainButtonRender(r,i,"open")+dg._curtainBtnWrapClose(i)},dg._curtainBtnWrapOpen=function(t){var e=t._button_wrapper?t._button_wrapper:null;return e?(dg.elementAttributesInit(e),e._format||(e._format="div"),e._attributes.id="curtain-btn-wrapper-"+t._attributes.id,t._button_wrapper=e,"<"+e._format+" "+dg.attributes(e._attributes)+">"):""},dg._curtainBtnWrapClose=function(t){return t._button_wrapper?"</"+t._button_wrapper._format+">":""},dg._curtainButtonRender=function(t,e,n){var r=t._type?t._type:"link",i=t._text?t._text:"open"==n?"+":"-";return"link"==r?dg.l(i,null,t):dg.b(i,t)},dg._curtainClick=function(t,e){var n=t.getAttribute("for"),r=dg._curtains[n],i=!!r._context,u=!!r._target,a=!i&&r._panel,d="open"==e?"close":"open",_="_"+e,o="_"+d,c=t.getAttribute("id");r[_].before&&r[_].before(t,r);var s=null;if(!a){var l=r[o]?r[o]:{},g=l.button?l.button:{};g._attributes||(g._attributes={}),g._attributes.id=c,g._attributes.onclick="dg._curtainClick(this, '"+d+"')",g._attributes.for||(g._attributes.for=n);var b=document.createElement("div");b.innerHTML=dg._curtainButtonRender(g,r,d),s=b.firstChild,t.parentNode.replaceChild(s,t)}if("open"==e){var p=null;if(u)p=dg.qs(r._target),p&&(""==p.innerHTML?p.innerHTML=dg.render(r._fill()):dg.show(p));else if(p=document.getElementById(n)){var f=document.getElementById(n);a?f.style.width="250px":dg.show(f)}else{var m=r._attributes.class;i?(m.push("context-menu"),r._context.side&&m.push("context-menu-"+r._context.side)):a&&m.push("side-panel",r._panel.side?"side-panel-"+r._panel.side:"side-panel-left");var v=r._format?variables._format:"div";b=document.createElement("div"),b.innerHTML="<"+v+" "+dg.attributes(r._attributes)+"></"+v+">",s?s.parentNode.insertBefore(b.firstChild,s.nextSibling):t.parentNode.insertBefore(b.firstChild,t.nextSibling);var h=dg.render(r._fill());if(a){var B=r._close?r._close:{},C=B.button?B.button:{};C._attributes||(C._attributes={}),C._attributes.id=c,C._attributes.onclick||(C._attributes.onclick="dg._curtainClick(this, 'close')"),C._attributes.for||(C._attributes.for=n),h=dg._curtainButtonRender(C,r,"close")+h}p=document.getElementById(n),p.innerHTML="open"==e?h:"",(i||a)&&dg._postRender.push(function(){setTimeout(function(){i||a&&(document.getElementById(n).style.width="250px")},50)}),dg.runPostRenders()}dg_curtain.setCurtain(r)}else{var f=u?dg.qs(r._target):document.getElementById(n);a?f.style.width="0":dg.hide(f),dg_curtain.clearCurtain()}r[_].after&&setTimeout(function(){r[_].after(a?t:s,r)},1)};