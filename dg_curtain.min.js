var dg_curtain=new dg.Module;dg.modules.dg_curtain=dg_curtain,DgCurtain=function(t,n){this._id=t,this._vars=n},DgCurtain.prototype.getContainer=function(){return dg.qs(this._vars._target?this._vars._target:"#"+this._vars._attributes.id)},DgCurtain.prototype.getOpenButtonId=function(){return this._vars._open.button._attributes.id},DgCurtain.prototype.getOpenButton=function(){return dg.qs("#"+this.getOpenButtonId())},DgCurtain.prototype.getCloseButtonId=function(){return this._vars._close.button._attributes.id},DgCurtain.prototype.getCloseButton=function(){return dg.qs("#"+this.getCloseButtonId())},DgCurtain.prototype.isOpen=function(){var t=this.getContainer();return!!t&&dg.isVisible(t)},DgCurtain.prototype.open=function(){var t=this.getOpenButton();t&&t.click()},DgCurtain.prototype.close=function(){var t=this.getCloseButton();t&&t.click()},dg_curtain.get=function(t){return dg._curtains[t]?dg._curtains[t]:null},dg_curtain.load=function(t){return new DgCurtain(t,dg_curtain.get(t))},dg.theme_context_menu=function(t){t._context?t._context:{};return dg.theme("curtain",t)},dg._curtains={},dg_curtain._curtain=null,dg_curtain.getCurtain=function(){return dg_curtain._curtain},dg_curtain.setCurtain=function(t){dg_curtain._curtain=t},dg_curtain.clearCurtain=function(){dg_curtain._curtain=null},dg_curtain.getButton=function(){return dg_curtain.getOpenButton()},dg_curtain.getOpenButton=function(){var t=dg_curtain.getCurtain();return t?document.getElementById(t._open.button._attributes.id):null},dg_curtain.getCloseButton=function(){var t=dg_curtain.getCurtain();return t?document.getElementById(t._close.button._attributes.id):null},dg_curtain.getContainer=function(){var t=dg_curtain.getCurtain();return t?document.getElementById(t._attributes.id):null},dg_curtain.isOpen=function(){var t=dg_curtain.getContainer();return t&&dg.isVisible(t)},dg_curtain.close=function(){var t=dg_curtain.getCloseButton();t&&t.click()},dg.theme_curtain=function(t){t._attributes.id||(t._attributes.id=dg.salt());var n=t._attributes.id;t._attributes.class.push("curtain");var e=t._open?t._open:{},r=e.button?e.button:{};dg.attributesInit(r),r._attributes.id||(r._attributes.id=dg.salt()),r._attributes.onclick||(r._attributes.onclick="dg._curtainClick(this, 'open')"),r._attributes.for||(r._attributes.for=n),dg._curtains[n]=t;var i=dg._curtains[n];return dg._curtainBtnWrapOpen(i)+dg._curtainButtonRender(r,i,"open")+dg._curtainBtnWrapClose(i)},dg._curtainBtnWrapOpen=function(t){var n=t._button_wrapper?t._button_wrapper:null;return n?(dg.elementAttributesInit(n),n._format||(n._format="div"),n._attributes.id="curtain-btn-wrapper-"+t._attributes.id,t._button_wrapper=n,"<"+n._format+" "+dg.attributes(n._attributes)+">"):""},dg._curtainBtnWrapClose=function(t){return t._button_wrapper?"</"+t._button_wrapper._format+">":""},dg._curtainButtonRender=function(t,n,e){var r=t._type?t._type:"link",i=t._text?t._text:"open"==e?"+":"-";return"link"==r?dg.l(i,null,t):dg.b(i,t)},dg._curtainClick=function(t,n){var e=t.getAttribute("for"),r=dg._curtains[e],i=!!r._context,u=!!r._target,a=!i&&r._panel,o="open"==n?"close":"open",d="_"+n,_="_"+o,c=t.getAttribute("id");r[d].before&&r[d].before(t,r);var s=null;if(!a){var g=r[_]?r[_]:{},l=g.button?g.button:{};dg.attributesInit(l),l._attributes.id||(l._attributes.id=c),l._attributes.onclick="dg._curtainClick(this, '"+o+"')",l._attributes.for||(l._attributes.for=e);var p=document.createElement("div");p.innerHTML=dg._curtainButtonRender(l,r,o),s=p.firstChild,t.parentNode.replaceChild(s,t)}var b=function(t){t.style.width="250px"};if("open"==n){var f=null;if(u)f=dg.qs(r._target),f&&(""==f.innerHTML&&(f.innerHTML=dg.render(r._fill())),dg.show(f));else if(f=document.getElementById(e)){var C=document.getElementById(e);a?b(C):dg.show(C)}else{var v=r._attributes.class;i?(v.push("context-menu"),r._context.side&&v.push("context-menu-"+r._context.side)):a&&v.push("side-panel",r._panel.side?"side-panel-"+r._panel.side:"side-panel-left");var m=r._format?variables._format:"div";p=document.createElement("div"),p.innerHTML="<"+m+" "+dg.attributes(r._attributes)+"></"+m+">",s?s.parentNode.insertBefore(p.firstChild,s.nextSibling):t.parentNode.insertBefore(p.firstChild,t.nextSibling);var h=dg.render(r._fill());if(a){var B=r._close?r._close:{},y=B.button?B.button:{};y._attributes||(y._attributes={}),y._attributes.id||(y._attributes.id=c),y._attributes.onclick||(y._attributes.onclick="dg._curtainClick(this, 'close')"),y._attributes.for||(y._attributes.for=e),h=dg._curtainButtonRender(y,r,"close")+h}f=document.getElementById(e),f.innerHTML="open"==n?h:"",(i||a)&&dg._postRender.push(function(){setTimeout(function(){i||a&&b(document.getElementById(e))},50)}),dg.runPostRenders()}dg_curtain.setCurtain(r)}else{var C=u?dg.qs(r._target):document.getElementById(e);a?C.style.width="0":dg.hide(C),dg_curtain.clearCurtain()}r[d].after&&setTimeout(function(){r[d].after(a?t:s,r)},1)};